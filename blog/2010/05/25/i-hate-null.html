<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>I hate NULL and all its variants! - Alexandru Nedelcu</title>
    

    <!-- Open Graph Meta -->
    <meta content="Alexandru Nedelcu" property="og:site_name">
    <meta content="I hate NULL and all its variants!" property="og:title">
    
      <meta content="On programming and personal projects" property="og:description">
    <meta content="https://alexn.org/blog/2010/05/25/i-hate-null.html" property="og:url">
    <meta content="2010-05-25T00:00:00+00:00" property="article:published_time">
    <meta content="2019-12-14T00:00:00+00:00" property="article:modified_time">
    
    <meta property="og:type" content="article" />
    <meta property="og:image" content="https://alexn.org/assets/media/articles/beautiful-soup.png" />
    <meta property="og:image:secure_url" content="https://alexn.org/assets/media/articles/beautiful-soup.png" />
    <meta content="https://www.facebook.com/alexelcu" property="article:author">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:src" content="https://alexn.org/assets/media/articles/beautiful-soup.png">
    <meta name="twitter:site" content="@alexelcu">
    <meta name="twitter:creator" content="@alexelcu">
    <meta name="twitter:title" content="I hate NULL and all its variants!">
    <meta name="twitter:url" content="https://alexn.org/blog/2010/05/25/i-hate-null.html">
    
      <meta name="twitter:description" content="On programming and personal projects">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="16x16" />
    <link rel="icon" href="/assets/logo/32px.png" sizes="32x32" />
    <link rel="icon" href="/assets/logo/192px.png" sizes="192x192" />
    <link rel="icon" href="/assets/logo/270px.png" sizes="270x270" />
    <link rel="apple-touch-icon-precomposed" href="/assets/logo/180px.png" />
    <meta name="msapplication-TileImage" content="/assets/logo/270px.png" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="Alexandru Nedelcu" href="https://alexn.org/feed.xml" />

    <!-- Stylesheet -->
    <link rel="stylesheet" href="/assets/css/style.css?202007091115">
    <link rel="preload" as="style" href="/assets/css/style.css?202007091115">
    
    <!--[if IE 8]><link rel="stylesheet" href="/assets/css/ie.css"><![endif]-->
    <link rel="canonical" href="https://alexn.org/blog/2010/05/25/i-hate-null.html">
</head>


<body>

   <div class="header">
  <div class="container">
    <h1 class="logo"><a href="/">Alex<span class="wide2">andru</span> Nedelcu<span class="wide1"> =&lt;&lt;</span></a></h1>
    <nav class="nav-collapse">
      <ul class="noList">
        
        <li class="element first current ">
          <a href="/">Blog</a>
        </li>
        
        <li class="element   ">
          <a href="/wiki/">Wiki</a>
        </li>
        
        <li class="element   ">
          <a href="/about.html">About</a>
        </li>
        
        <li class="element   last">
          <a href="/subscribe.html">Subscribe</a>
        </li>
        
      </ul>
    </nav>
  </div>
</div><!-- end .header -->


   <div class="content">
      <div class="container">
         <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
      <h1 class="postTitle" itemprop="headline">
        
        
          I hate NULL and all its variants!
        
        
      </h1>
  <p class="meta">
    <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2010/05/25/i-hate-null.html"/>
    <meta itemprop="datePublished" content="2010-05-25T00:00:00+0000"/>
    
    <time itemprop="dateCreated" datetime="2010-05-25T00:00:00+0000">May 25, 2010</time>
    | <nobr><span class="time">5</span> minute</nobr>
  </p>

  <figure class="featuredImage" itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
      <meta itemprop="url" content="https://alexn.org/assets/media/articles/beautiful-soup.png" />
      <img src="/assets/media/articles/beautiful-soup.png" alt="" />
      
    </figure>
    
  

  <div class="hidden" itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
    <meta itemprop="name" content="Alexandru Nedelcu">
    <meta itemprop="url" content="https://alexn.org/about.html">
    <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
      <meta itemprop="url" content="https://alexn.org/assets/raw/logo-green.png">
    </div>
  </div>
  <div class="hidden" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alexandru Nedelcu" />
      <meta itemprop="url" content="https://alexn.org/about.html#alexelcu" />
      <meta itemprop="url" content="https://twitter.com/alexelcu" />
      <meta itemprop="url" content="https://www.facebook.com/alexelcu" />
      <meta itemprop="url" content="https://github.com/alexandru" />
    </div>
  

  <div id="content" itemprop="articleBody">
    <p class="intro withcap">
    How many times have you had a chain of methods like this (example showing <a href="https://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> in action) …
</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'table'</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span><span class="s">'search-params'</span><span class="p">})</span>\
    <span class="p">.</span><span class="n">findParent</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'td'</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="s">'elem'</span><span class="p">})</span>\
    <span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'input'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
</code></pre></div></div>

<p>BeautifulSoup is not JQuery, and when it doesn’t find an element on find actions, it just returns None or an empty list. Then you get a beautiful index error or a method not available on NoneType kind of error, with the result being that the error itself doesn’t say anything useful about what happened (except the source-code line number) … whereas in the case above I would probably prefer a WebUIError or something.</p>

<p>And really, most of the time I just want the result of such an expression to be None, in case one method invocation fails, and I do not think that having a try/except block for every line of code that does something interesting is ideal.</p>

<p>Fortunately Python is dynamic, and you can come up with something resembling the <a href="http://en.wikipedia.org/wiki/Monad_(functional_programming)#Maybe_monad">Maybe monad</a>. Here’s one way to do it …</p>

<ol>
  <li>instead of sending invocations to your initial object / collection (in my case a BeautifulSoup object used for querying), you’re sending them to a proxy</li>
  <li>for each invocation type you want, the proxy stores the invocation types into a list</li>
  <li>when you want to execute the resulting expression, you iterate through that list actually invoking those actions, keeping an intermediate result</li>
  <li>if at any point that intermediate result becomes None (or something that evaluates to False) or an exception is thrown, then you can either invoke some handler (specializing the exception thrown) or you can return None</li>
</ol>

<p>There are 3 types of invocations I needed to work with BeautifulSoup …</p>

<ol>
  <li>attribute access (overridden with <code class="language-plaintext highlighter-rouge">__getattr__</code>)</li>
  <li>method invocation (overridden with <code class="language-plaintext highlighter-rouge">__call__</code>)</li>
  <li>indexer (overridden with <code class="language-plaintext highlighter-rouge">__getitem__</code> and <code class="language-plaintext highlighter-rouge">__setitem__</code>)</li>
</ol>

<p>My proxy implementation starts something like this …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">class</span> <span class="nc">Proxy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">on_error_callback</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">_chain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">_memo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_wrapped_inst</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_chain</span> <span class="o">=</span> <span class="n">_chain</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_on_error_callback</span> <span class="o">=</span> <span class="n">on_error_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_memo</span> <span class="o">=</span> <span class="n">_memo</span> <span class="ow">or</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_new_proxy</span><span class="p">(</span><span class="n">ProxyAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_new_proxy</span><span class="p">(</span><span class="n">ProxyInvoke</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></div>

<p>As you can see, there’s an <em>instance</em> of an object getting wrapped (<code class="language-plaintext highlighter-rouge">_wrapped_instance</code>), there’s a <code class="language-plaintext highlighter-rouge">_chain</code> of expressions memorized, there’s an <code class="language-plaintext highlighter-rouge">_on_error_callback</code> that gets executed in case of error, and there’s a <code class="language-plaintext highlighter-rouge">_memo</code> that keeps the result of the last execution (libraries like BeautifulSoup are slow).</p>

<p>Of course, I’m getting fancy, because I want <a href="https://en.wikipedia.org/wiki/Memoization">memoization</a> and because in order to prevent the proxy getting into an inconsistent state, when adding a new invocation type to the <code class="language-plaintext highlighter-rouge">_chain</code> I’m taking a page from functional programming by creating a new proxy object (making the proxy somewhat immutable).</p>

<p>So I override <code class="language-plaintext highlighter-rouge">__getattr__</code> and <code class="language-plaintext highlighter-rouge">__call__</code> and <code class="language-plaintext highlighter-rouge">__getitem__</code> and <code class="language-plaintext highlighter-rouge">__setitem__</code>. For example on <code class="language-plaintext highlighter-rouge">__getattr__</code> I add to <code class="language-plaintext highlighter-rouge">_chain</code> an instance of a <code class="language-plaintext highlighter-rouge">ProxyAttribute</code>, which looks something like this …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">class</span> <span class="nc">ProxyAttribute</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"."</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p>And when I want the result of such invocation, if the intermediate result is stored in <code class="language-plaintext highlighter-rouge">obj</code>, then it would look like …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">obj</span> <span class="o">=</span> <span class="n">proxy_attribute_instance</span><span class="p">.</span><span class="n">do</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</code></pre></div></div>

<p>Now, for how it would look in practice …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">def</span> <span class="nf">handler_soup_error</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="k">raise</span> <span class="n">WebUIError</span><span class="p">(</span><span class="s">"Web interface specification changed"</span><span class="p">)</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">document</span><span class="p">),</span> <span class="n">handler_soup_error</span><span class="p">)</span>

<span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'table'</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span><span class="s">'search-params'</span><span class="p">}).</span><span class="n">findParent</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'td'</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="s">'elem'</span><span class="p">})</span>\
    <span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'input'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">do</span><span class="p">()</span>
</code></pre></div></div>

<p>So at the actual call site, the only difference is that <code class="language-plaintext highlighter-rouge">do()</code> call. If the error handler wouldn’t be specified, the result returned would be <code class="language-plaintext highlighter-rouge">None</code>. Simple as that.</p>

<p>I also needed an utility, because I want to capture a partial evaluation to not rerun it for multiple special cases (like in the above case capturing all “td” elements) …</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">all_td_elems</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'table'</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span><span class="s">'search-params'</span><span class="p">})</span>\
    <span class="p">.</span><span class="n">findParent</span><span class="p">(</span><span class="s">'form'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'td'</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="s">'elem'</span><span class="p">})</span>\
    <span class="p">.</span><span class="n">do_cache</span><span class="p">()</span> <span class="c1"># not an inspiring name unfortunately
</span>
    <span class="c1"># and then resume with the same behavior ...
</span>    <span class="n">all_td_elements</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'input'</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">).</span><span class="n">do</span><span class="p">()</span>
</code></pre></div></div>

<p>Yeah, it’s just a small hack, but it’s so damn useful sometimes. Full source code is posted here: <a href="/wiki/snippets/python-proxy.html">python-proxy.py</a></p>

  </div>

  <div id="article-details">
    
    <time itemprop="dateModified" content="2019-12-14T00:00:00+0000">
        Updated: December 14, 2019
    </time>
    
      | Written by <a href="https://alexn.org/about.html#alexelcu" itemprop="url" rel="author">Alexandru Nedelcu</a>
    

    <div id="all-categories">
      Tags:
      
        
        <a href="/tag/rant/" class="category">rant</a>
      
         | 
        <a href="/tag/python/" class="category">python</a>
      
    </div>
  </div>

  
  <div class="related">
    
      <h2>
        
        
          Related Articles
        
        
      </h2>
    <div class="container">
      
      

      
      
      <div class="item">
        <a class="related-link" href="/blog/2012/11/02/scala-functional-programming-type-classes.html">
          On Scala, Functional Programming and Type-Classes
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/tag/languages" class="tag">languages</a>
            
               | <a href="/tag/functional" class="tag">functional</a>
            
               | <a href="/tag/scala" class="tag">scala</a>
            
               | <a href="/tag/clojure" class="tag">clojure</a>
            
               | <a href="/tag/java" class="tag">java</a>
                        
          </div>
          <time>November 2, 2012</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2017/01/30/asynchronous-programming-scala.html">
          Asynchronous Programming and Scala
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/tag/best of" class="tag">best of</a>
            
               | <a href="/tag/scala" class="tag">scala</a>
            
               | <a href="/tag/asynchrony" class="tag">asynchrony</a>
            
               | <a href="/tag/concurrency" class="tag">concurrency</a>
                        
          </div>
          <time>January 30, 2017</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2018/02/12/in-defense-oofp.html">
          In Defense of OOFP
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/tag/best of" class="tag">best of</a>
            
               | <a href="/tag/oop" class="tag">oop</a>
            
               | <a href="/tag/fp" class="tag">fp</a>
            
               | <a href="/tag/haskell" class="tag">haskell</a>
            
               | <a href="/tag/scala" class="tag">scala</a>
                        
          </div>
          <time>February 12, 2018</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2018/05/06/bifunctor-io.html">
          On Bifunctor IO and Java's Checked Exceptions
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/tag/best of" class="tag">best of</a>
            
               | <a href="/tag/fp" class="tag">fp</a>
            
               | <a href="/tag/typelevel" class="tag">typelevel</a>
            
               | <a href="/tag/scala" class="tag">scala</a>
            
               | <a href="/tag/haskell" class="tag">haskell</a>
                        
          </div>
          <time>May 6, 2018</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      <div class="clearfix"></div>
    </div>
  </div>
  

  
</article>
      </div>
   </div><!-- end .content -->

   <div class="footer">
  
  <div class="container">
    <div class="contributions">
      
<h2>Contribute</h2>

<p>
  You can fix or add to this article by submitting a pull request:
  <a style="white-space: nowrap;" href="https://github.com/alexandru/alexn.org/blob/master/_posts/2010-05-25-i-hate-null.md" target="_blank">Edit Page on GitHub</a>
</p>


<h3 id="comments">Comments</h3>

<script>
  document.write('<div class="note">Be nice!<br><span class="extra">If you don\'t see the commenting widget, it might be blocked (see this <a href="https://github.com/utterance/utterances/issues/341" target="_blank">Privacy Badger issue</a>).</span></div>');
</script>
<script src="https://utteranc.es/client.js"
        repo="alexandru/alexn.org"
        issue-term="pathname"
        label="discussion"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>
  <div class="note">
    <strong>Enable JavaScript to see comments!</strong>
    <br>
    <span class="extra">
      Commenting widget is powered by GitHub's API and 
      <a href="https://utteranc.es" target="_blank">utteranc.es</a>. This website does not
      track visitors or log personally identifiable information, see our 
      <a href="/docs/privacy-policy.html">privacy policy</a>.
    </span>
  </div>
</noscript>


    </div>  
  </div>
  

  <div class="bottom">
    <div class="container">
      <span class="copy">
          &copy; 2020
      </span>
      <span class="links">
        <a href="/docs/license.html">License</a> |
        <a href="/docs/privacy-policy.html">Privacy Policy</a> |
        <a href="/about.html#contact">Contact</a>
      </span>
    </div>
  </div>
</div><!-- end .footer -->

   <script async src="/assets/js/modernizr.custom.15390.js?202007091115" type="text/javascript"></script>
<script async src="/assets/js-managed/jquery/dist/jquery.slim.min.js?202007091115" type="text/javascript"></script>
<script async src="/assets/js/dropcap.min.js?202007091115" type="text/javascript"></script>
<script async src="/assets/js/responsive-nav.min.js?202007091115" type="text/javascript"></script>

<script async src="/assets/js/scripts.js?202007091115" type="text/javascript"></script>

<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(['disableCookies']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//ly.alexn.org/";
    _paq.push(['setTrackerUrl', u+'m.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'m.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>
  
  <img src="https://ly.alexn.org/m.php?idsite=1&rec=1&action_name=I+hate+NULL+and+all+its+variants%21" style="border:0" alt="" />
</noscript>


   
   <!-- <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us20.list-manage.com","uuid":"6c8297e886b517d8535e8410e","lid":"a3391a44b0","uniqueMethods":true}) })</script> -->
   
</body>

</html>
