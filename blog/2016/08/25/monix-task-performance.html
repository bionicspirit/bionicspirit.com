<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <link rel="canonical" href="https://alexn.org/blog/2016/08/25/monix-task-performance.html">
  <link rel="alternate" href="/atom.xml" title="Atom feed" type="application/atom+xml">

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@alexelcu" />

    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2016-08-25" />
    
    <meta property="article:tag" content="Functional" />
    <meta property="article:tag" content="Code" />
    <meta property="article:tag" content="Scala" />
    <meta property="article:tag" content="Monix" />
    <meta property="article:tag" content="Scalaz" />
    <meta property="article:tag" content="Typelevel" />

    <title>Monix Task vs Scalaz vs Future, The Benchmark</title>
    <meta name="og:title" content="Monix Task vs Scalaz vs Future, The Benchmark" />
    <meta name="twitter:title" content="Monix Task vs Scalaz vs Future, The Benchmark" />

      <meta name="og:image" content="https://alexn.org/assets/img/2015/monifu-square.png" />
      <meta name="og:image:secure_url" content="https://alexn.org/assets/img/2015/monifu-square.png" />
      <meta name="twitter:image" content="https://alexn.org/assets/img/2015/monifu-square.png" />

      <meta name="og:description" content="The Task in Monix has really good performance. See the benchmark." />
      <meta name="twitter:description" content="The Task in Monix has really good performance. See the benchmark." />
      <meta name="description" content="The Task in Monix has really good performance. See the benchmark." />

  <link href="/assets/css/fonts-8b37e535.css" rel="stylesheet" />
  <link href="/assets/css/all-3b6fe599.css" rel="stylesheet" />
  <!--[if lt IE 9]>
  <link href="/assets/css/ie-hacks-0c76b2ed.css" rel="stylesheet" />
  <![endif]-->
</head>
<body>
  <div id="header-container">
    <header>
      <h1 id="title">alexn.org</h1>

      <meta itemprop="lastReviewed" content="2019-01-03"/>
      <div itemprop="reviewedBy" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <meta itemprop="url" content="https://alexn.org/about.html">
      </div>

      <div class="github-fork-ribbon-wrapper right">
        <div class="github-fork-ribbon">
          <a href="https://github.com/alexandru" itemprop="relatedLink">Fork me on GitHub</a>
        </div>
      </div>

      <nav>
    	  <a href="/">alexn.org</a>
    	  <a class="extra" href="/about.html" itemprop="significantLink">About</a>
      </nav>
    </header>
  </div>

  <div id="main-container">
    <div id="main">
      <article id="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 itemprop="headline">Monix Task vs Scalaz vs Future, The Benchmark</h1>

    <div id="meta">
      <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2016/08/25/monix-task-performance.html"/>
      <meta itemprop="datePublished" content="2016-08-25"/>
      <meta itemprop="dateModified" content="2016-08-25"/>

      <time class="post-date" itemprop="dateCreated" datetime="2016-08-25">
        Aug 25, 2016
      </time>

      <span class="twitter-link">
        • <a href="https://twitter.com/alexelcu">@alexelcu</a>
      </span>

        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/2015/monifu-square.png">
          <meta itemprop="width" content="500">
          <meta itemprop="height" content="303">
        </div>

      <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/alex-big-version-72ppi.jpg">
          <meta itemprop="width" content="585">
          <meta itemprop="height" content="585">
        </div>
      </div>
    </div>
  </header>

  <div id="content" itemprop="articleBody">
    <p><img src="/assets/img/2015/monifu-square.png" class="right" width="200" alt="Monifu square" /></p>

<p>The Monix <a href="https://monix.io/docs/2x/eval/task.html">Task</a> was heavily
inspired by <code class="highlighter-rouge">scalaz.concurrent.Task</code> and by
<code class="highlighter-rouge">scala.concurrent.Future</code>. That's not a secret and I'll be forever
grateful to their authors. I've ran a benchmark and I'm glad to report
that the Monix <a href="https://monix.io/docs/2x/eval/task.html">Task</a> beats
in performance both.</p>

<p>Such results are actually unexpected, because the Monix <code class="highlighter-rouge">Task</code> has to
do tricks in order to be "<em>cancelable</em>", a trait that allows it to
close opened resources when race conditions happen, which really means
extra footwork. But no, right now, it beats both in performance and by
quite the margin.</p>

<p>Details:</p>

<ul>
  <li>Benchmark used is
<a href="https://github.com/monixio/monix/blob/v2.0-RC13/benchmarks/src/main/scala/monix/TaskGatherBenchmark.scala">TaskGatherBenchmark</a>
in the repository</li>
  <li>Monix version: <code class="highlighter-rouge">2.0-RC13</code></li>
  <li>Scalaz version: <code class="highlighter-rouge">7.2.4</code></li>
  <li>Scala version: <code class="highlighter-rouge">2.11.8</code></li>
  <li>Java version: <code class="highlighter-rouge">1.8.0_60</code></li>
  <li>OS: OS X El Captain, version <code class="highlighter-rouge">10.11.6</code></li>
</ul>

<h3 id="sequence">Sequence</h3>

<p>The purpose of this test is the performance of <code class="highlighter-rouge">flatMap</code>, or in other
words the performance of the run-loop, on both normal/synchronous
tasks and tasks that are forked in separate (logical) threads. So in
other words:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="nc">Task</span><span class="o">.</span><span class="n">sequence</span><span class="o">(</span><span class="n">tasks</span><span class="o">)</span>
</code></pre></div>
<p>Which is translated more or less into this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="n">tasks</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="n">init</span><span class="o">)((</span><span class="n">acc</span><span class="o">,</span><span class="n">et</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">acc</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">b</span> <span class="k">=&gt;</span> <span class="n">et</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">e</span> <span class="k">=&gt;</span> <span class="n">b</span> <span class="o">+=</span> <span class="n">e</span><span class="o">)))</span>
</code></pre></div>
<p>So for synchronous tasks (that evaluate immediately), and note here
that Scala's <code class="highlighter-rouge">Future</code> is not applicable since <code class="highlighter-rouge">Future</code> is not
trampolined:</p>

<table>
  <thead>
    <tr>
      <th>Source</th>
      <th>Type</th>
      <th>Operation</th>
      <th>Score</th>
      <th>Error</th>
      <th>Units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Monix</td>
      <td>Sync</td>
      <td>Sequence</td>
      <td>6716.906</td>
      <td>157.947</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>Scalaz</td>
      <td>Sync</td>
      <td>Sequence</td>
      <td>3518.888</td>
      <td>167.148</td>
      <td>ops/s</td>
    </tr>
  </tbody>
</table>

<p>And for tasks that fork threads on execution:</p>

<table>
  <thead>
    <tr>
      <th>Source</th>
      <th>Type</th>
      <th>Operation</th>
      <th>Score</th>
      <th>Error</th>
      <th>Units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Monix</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>2044.624</td>
      <td>24.852</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>Scalaz</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>1090.355</td>
      <td>15.851</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>S.Future</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>1753.614</td>
      <td>20.871</td>
      <td>ops/s</td>
    </tr>
  </tbody>
</table>

<p>As you can see, the Monix <code class="highlighter-rouge">Task</code> has twice the throughput of Scalaz
and fares quite better compared with Scala's standard <code class="highlighter-rouge">Future</code>.</p>

<h3 id="gather">Gather</h3>

<p>The gather operation would be:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="nc">Task</span><span class="o">.</span><span class="n">gather</span><span class="o">(</span><span class="n">tasks</span><span class="o">)</span>
</code></pre></div>
<p>This works like <code class="highlighter-rouge">sequence</code>, except that the evaluation has non-ordered
effects. What this means is that, if the tasks are forking threads,
then they get executed in parallel.</p>

<p>For synchronous/immediate tasks the numbers are:</p>

<table>
  <thead>
    <tr>
      <th>Source</th>
      <th>Type</th>
      <th>Operation</th>
      <th>Score</th>
      <th>Error</th>
      <th>Units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Monix</td>
      <td>Sync</td>
      <td>Gather</td>
      <td>3800.559</td>
      <td>341.509</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>Scalaz</td>
      <td>Sync</td>
      <td>Gather</td>
      <td>2152.441</td>
      <td>13.569</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>S.Future</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>1753.614</td>
      <td>20.871</td>
      <td>ops/s</td>
    </tr>
  </tbody>
</table>

<p>And for forked tasks:</p>

<table>
  <thead>
    <tr>
      <th>Source</th>
      <th>Type</th>
      <th>Operation</th>
      <th>Score</th>
      <th>Error</th>
      <th>Units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Monix</td>
      <td>Forked</td>
      <td>Gather</td>
      <td>1396.797</td>
      <td>17.098</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>Scalaz</td>
      <td>Forked</td>
      <td>Gather</td>
      <td>1014.452</td>
      <td>13.569</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>S.Future</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>1753.614</td>
      <td>20.871</td>
      <td>ops/s</td>
    </tr>
  </tbody>
</table>

<p>Including the results of <code class="highlighter-rouge">Future.sequence</code> as well, because <code class="highlighter-rouge">Future</code>
has strict evaluation and it can be used to execute futures in
parallel. The performance of <code class="highlighter-rouge">gather</code> can be worse than
<code class="highlighter-rouge">Future.sequence</code>, because of the execution model. But if it executes
tasks that have immediate execution, or a mixed batch, then it is much
better.</p>

<h3 id="gather-unordered">Gather Unordered</h3>

<p>The <code class="highlighter-rouge">gatherUnordered</code> operation would be:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="nc">Task</span><span class="o">.</span><span class="n">gatherUnordered</span><span class="o">(</span><span class="n">tasks</span><span class="o">)</span>
</code></pre></div>
<p>This behaves like <code class="highlighter-rouge">gather</code>, except that it does not care for the order
in which the results are served. Can have much better performance if
you don't care about order.</p>

<p>For synchronous/immediate tasks:</p>

<table>
  <thead>
    <tr>
      <th>Source</th>
      <th>Type</th>
      <th>Operation</th>
      <th>Score</th>
      <th>Error</th>
      <th>Units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Monix</td>
      <td>Sync</td>
      <td>Unordered</td>
      <td>5654.462</td>
      <td>150.792</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>Scalaz</td>
      <td>Sync</td>
      <td>Unordered</td>
      <td>3340.645</td>
      <td>244.145</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>S.Future</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>1753.614</td>
      <td>20.871</td>
      <td>ops/s</td>
    </tr>
  </tbody>
</table>

<p>For forked tasks:</p>

<table>
  <thead>
    <tr>
      <th>Source</th>
      <th>Type</th>
      <th>Operation</th>
      <th>Score</th>
      <th>Error</th>
      <th>Units</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Monix</td>
      <td>Forked</td>
      <td>Unordered</td>
      <td>1658.055</td>
      <td>12.114</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>Scalaz</td>
      <td>Forked</td>
      <td>Unordered</td>
      <td>1657.454</td>
      <td>35.218</td>
      <td>ops/s</td>
    </tr>
    <tr>
      <td>S.Future</td>
      <td>Forked</td>
      <td>Sequence</td>
      <td>1753.614</td>
      <td>20.871</td>
      <td>ops/s</td>
    </tr>
  </tbody>
</table>

<p>Again, performance is really good for synchronous tasks, whereas for
forked tasks it evens out with the performance of <code class="highlighter-rouge">Future.sequence</code>.</p>

<h3 id="raw-output">Raw output</h3>

<div class="highlight"><pre class="highlight plaintext"><code>[info] # Run complete. Total time: 00:04:28
[info]
[info] Benchmark                              Mode  Cnt     Score     Error  Units
[info] TaskGatherBenchmark.gatherMonixA      thrpt   10  1396.797 ±  17.098  ops/s
[info] TaskGatherBenchmark.gatherMonixS      thrpt   10  3800.559 ± 341.509  ops/s
[info] TaskGatherBenchmark.gatherScalazA     thrpt   10  1014.452 ±  13.569  ops/s
[info] TaskGatherBenchmark.gatherScalazS     thrpt   10  2152.441 ±  24.811  ops/s
[info] TaskGatherBenchmark.sequenceFutureA   thrpt   10  1753.614 ±  20.871  ops/s
[info] TaskGatherBenchmark.sequenceMonixA    thrpt   10  2044.624 ±  24.852  ops/s
[info] TaskGatherBenchmark.sequenceMonixS    thrpt   10  6716.906 ± 157.947  ops/s
[info] TaskGatherBenchmark.sequenceScalazA   thrpt   10  1090.355 ±  15.851  ops/s
[info] TaskGatherBenchmark.sequenceScalazS   thrpt   10  3518.888 ± 167.148  ops/s
[info] TaskGatherBenchmark.unorderedMonixA   thrpt   10  1658.055 ±  12.114  ops/s
[info] TaskGatherBenchmark.unorderedMonixS   thrpt   10  5654.462 ± 150.792  ops/s
[info] TaskGatherBenchmark.unorderedScalazA  thrpt   10  1657.454 ±  35.218  ops/s
[info] TaskGatherBenchmark.unorderedScalazS  thrpt   10  3340.645 ± 244.145  ops/s
</code></pre></div>
<p>Cheers!</p>


    <div class="authorship" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alexandru Nedelcu">
      Written by <a href="https://alexn.org/about.html" itemprop="url" rel="author">
        Alexandru Nedelcu</a> |
      <a href="https://twitter.com/alexelcu" itemprop="url" rel="author">
        Twitter</a> |
      <a href="https://github.com/alexandru" itemprop="url" rel="author">
        GitHub</a>
    </div>
  </div>

  <footer>
    <div id="other-articles">
      <h2>Recent Articles</h2>

      <ul class="posts">
      	<li>
      	  <time datetime="2018-05-06">
      	    2018-05-06 &raquo;
      	  </time>
      	  <a href="/blog/2018/05/06/bifunctor-io.html" rel="prefetch related">On Bifunctor IO and Java's Checked Exceptions</a>
      	</li>
      	<li>
      	  <time datetime="2018-02-12">
      	    2018-02-12 &raquo;
      	  </time>
      	  <a href="/blog/2018/02/12/in-defense-oofp.html" rel="prefetch related">In Defense of OOFP</a>
      	</li>
      	<li>
      	  <time datetime="2017-11-10">
      	    2017-11-10 &raquo;
      	  </time>
      	  <a href="/blog/2017/11/10/minitest-no-crap-scala-library.html" rel="prefetch related">Minitest: Zero Crap Scala Testing Library</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-15">
      	    2017-10-15 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/15/functional-programming.html" rel="prefetch related">What is Functional Programming?</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-13">
      	    2017-10-13 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/13/scaladays-copenhagen.html" rel="prefetch related">Scala Days 2017 — Monix Task</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-11">
      	    2017-10-11 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/11/javascript-promise-leaks-memory.html" rel="prefetch related">JavaScript's Promise Leaks Memory</a>
      	</li>
      	<li>
      	  <time datetime="2017-08-16">
      	    2017-08-16 &raquo;
      	  </time>
      	  <a href="/blog/2017/08/16/automatic-releases-sbt-travis.html" rel="prefetch related">Automatic Releases to Maven Central with Travis and SBT</a>
      	</li>
      </ul>
    </div>

    <div id="contributions">
      <script data-isso="/comments/alexn/"
              data-isso-css="true"
              data-isso-lang="en"
              data-isso-reply-to-self="true"
              data-isso-require-author="true"
              data-isso-require-email="false"
              data-isso-reply-notifications="true"
              data-isso-max-comments-top="10"
              data-isso-max-comments-nested="5"
              data-isso-reveal-on-click="5"
              data-isso-gravatar="true"
              data-isso-avatar="false"
              data-isso-vote="true"
              data-vote-levels=""
              src="https://alexn.org/comments/alexn/js/embed.min.js"></script>
      <section id="isso-thread" data-title="{{ page.title }}">
      </section>
    </div>
  </footer>
</article>

    </div>
  </div>

  <div id="footer-container">
    <footer>
      <div class="contact">
      	&copy; 2019 Alexandru Nedelcu
      	<br>
      	Some rights reserved (<a href="http://creativecommons.org/licenses/by-nc/3.0/" rel="license">CC BY-NC 3.0</a>)
      </div>

      <div class="rss">
      	<a href="https://twitter.com/alexelcu" target="_blank" title="Follow me on Twitter (@alexelcu)">
      	  <img src="/assets/img/twitter-logo.png" width="60" height="60" alt="Follow me on Twitter (@alexelcu)" />
      	</a>
      </div>
    </footer>
  </div>

  <!-- Matomo -->
  <script type="text/javascript">
    var _paq = _paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://oriel.matomo.cloud/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', '2']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src='//cdn.matomo.cloud/oriel.matomo.cloud/piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <noscript><p><img src="https://oriel.matomo.cloud/piwik.php?idsite=2&amp;rec=1" style="border:0;" alt="" /></p></noscript>
  <!-- End Matomo Code -->
</body>
</html>
