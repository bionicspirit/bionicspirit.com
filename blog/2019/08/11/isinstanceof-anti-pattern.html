<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <link rel="canonical" href="https://alexn.org/blog/2019/08/11/isinstanceof-anti-pattern.html">
  <link rel="alternate" href="/atom.xml" title="Atom feed" type="application/atom+xml">

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@alexelcu" />

    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2019-08-11" />
    
    <meta property="article:tag" content="Programming" />
    <meta property="article:tag" content="Scala" />

    <title>Scala's isInstanceOf is an Anti-Pattern</title>
    <meta name="og:title" content="Scala&#x27;s isInstanceOf is an Anti-Pattern" />
    <meta name="twitter:title" content="Scala&#x27;s isInstanceOf is an Anti-Pattern" />

      <meta name="og:image" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg" />
      <meta name="og:image:secure_url" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg" />
      <meta name="twitter:image" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg" />

      <meta name="og:description" content="Scala has a much better way of discriminating between types." />
      <meta name="twitter:description" content="Scala has a much better way of discriminating between types." />
      <meta name="description" content="Scala has a much better way of discriminating between types." />

  <link href="/assets/css/fonts-8b37e535.css" rel="stylesheet" />
  <link href="/assets/css/all-242873bd.css" rel="stylesheet" />
  <!--[if lt IE 9]>
  <link href="/assets/css/ie-hacks-f1291769.css" rel="stylesheet" />
  <![endif]-->
</head>
<body>
  <div id="header-container">
    <header>
      <h1 id="title">alexn.org</h1>

      <meta itemprop="lastReviewed" content="2019-08-11"/>
      <div itemprop="reviewedBy" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <meta itemprop="url" content="https://alexn.org/about.html">
      </div>

      <div class="github-fork-ribbon-wrapper right">
        <div class="github-fork-ribbon">
          <a href="https://github.com/alexandru" itemprop="relatedLink">Fork me on GitHub</a>
        </div>
      </div>

      <nav>
    	  <a href="/">alexn.org</a>
    	  <a class="extra" href="/about.html" itemprop="significantLink">About</a>
      </nav>
    </header>
  </div>

  <div id="main-container">
    <div id="main">
      <article id="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 itemprop="headline">Scala's isInstanceOf is an Anti-Pattern</h1>

    <div id="meta">
      <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2019/08/11/isinstanceof-anti-pattern.html"/>
      <meta itemprop="datePublished" content="2019-08-11"/>
      <meta itemprop="dateModified" content="2019-08-11"/>

      <time class="post-date" itemprop="dateCreated" datetime="2019-08-11">
        Aug 11, 2019
      </time>

      <span class="twitter-link">
        • <a href="https://twitter.com/alexelcu">@alexelcu</a>
      </span>

        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg">
          <meta itemprop="width" content="400">
          <meta itemprop="height" content="400">
        </div>

      <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/alex-big-version-72ppi.jpg">
          <meta itemprop="width" content="585">
          <meta itemprop="height" content="585">
        </div>
      </div>
    </div>
  </header>

  <div id="content" itemprop="articleBody">
    <p>When you use <code class="highlighter-rouge">isInstanceOf[Class]</code> checks, that's an anti-pattern, as Scala has a much better way of discriminating between types. Scala has implicit parameters, with which you can describe <a href="https://en.wikipedia.org/wiki/Type_class">type classes</a>.</p>

<p>Let's do an exercise …</p>

<!-- read more -->

<p class="extra-info">
  When C# developers try Java, one primary complaint is about the lack of reification for Java's generics and by that they mean the ability to discriminate between different type parameters, so to differentiate between <code class="highlighter-rouge">List[Int]</code> and <code class="highlighter-rouge">List[String]</code> via <code class="highlighter-rouge">isInstanceOf</code> checks. Java and Scala do type erasure so a <code class="highlighter-rouge">List[String]</code> at runtime becomes a <code class="highlighter-rouge">List[Any]</code>.
  <br /><br />
  Interestingly this complaint is not valid for Scala. Because of Scala's expressiveness, you shouldn't need to do <code class="highlighter-rouge">isInstanceOf</code> checks, unless it's for interoperability or for awkward micro optimizations that have no place in high level code. Reification is a runtime construct and Scala solves the associated use cases by moving all of that at compile time, via implicit parameters.
</p>

<h2 id="the-anti-pattern">The Anti-Pattern</h2>

<p>Given some piece of heavy logic, let's say you want to describe a function that can execute a block of code, along with some finalizer, something like this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">def</span> <span class="nf">guarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span>
  <span class="k">try</span> <span class="n">f</span> <span class="k">finally</span> <span class="n">finalizer</span>
</code></pre></div>
<p>And usage:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="n">guarantee</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="s">"Executing!"</span><span class="o">)</span>
  <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">}</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="s">"Done!"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div>
<p>Then one of your colleagues comes along and tries it with <code class="highlighter-rouge">Future</code>:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">import</span> <span class="nn">scala.concurrent.Future</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>

<span class="n">guarantee</span> <span class="o">{</span>
  <span class="nc">Future</span> <span class="o">{</span>
    <span class="nf">println</span><span class="o">(</span><span class="s">"Executing!"</span><span class="o">)</span>
    <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="s">"Done!"</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">//=&gt; Done!
//=&gt; Executing!
</span></code></pre></div>
<p>Oops! This doesn't work, so one of you might get the bright idea to do this instead:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">import</span> <span class="nn">scala.util.control.NonFatal</span>

<span class="k">def</span> <span class="nf">guarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">f</span> <span class="k">match</span> <span class="o">{</span>
      <span class="c1">// Anti-pattern
</span>      <span class="k">case</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="k">=&gt;</span>
        <span class="nv">ref</span><span class="o">.</span><span class="py">transform</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=&gt;</span> <span class="n">finalizer</span><span class="o">;</span> <span class="n">r</span> <span class="o">}</span>
          <span class="o">.</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span>
      <span class="k">case</span> <span class="n">result</span> <span class="k">=&gt;</span>
        <span class="n">finalizer</span>
        <span class="n">result</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">NonFatal</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="n">finalizer</span>
      <span class="k">throw</span> <span class="n">e</span>
  <span class="o">}</span>
</code></pre></div>
<p>This logic isn't extensible — What happens when you'll want to introduce logic for Java's <code class="highlighter-rouge">CompletableFuture</code>, Monix's <code class="highlighter-rouge">Task</code>, Cats-Effect's <code class="highlighter-rouge">IO</code> and so on? Each type gets its own branch?</p>

<p>We've run into the <a href="https://en.wikipedia.org/wiki/Expression_problem">expression problem</a> and yet our <code class="highlighter-rouge">R</code> data type is not a <a href="https://en.wikipedia.org/wiki/Tagged_union">tagged union</a>, meaning that the set of possible values in that pattern match is endless.</p>

<p>The second problem is the default branch. We are assuming that, in case <code class="highlighter-rouge">R</code> is not a <code class="highlighter-rouge">Future</code>, then we are dealing with a side effectful function that executes synchronously. So one of your colleagues comes along and does this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">import</span> <span class="nn">monix.eval.Task</span>

<span class="n">guarantee</span> <span class="o">{</span>
  <span class="c1">// Oh noes!
</span>  <span class="nc">Task</span> <span class="o">{</span>
    <span class="nf">println</span><span class="o">(</span><span class="s">"Executing!"</span><span class="o">)</span>
    <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="s">"Done!"</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">//=&gt; Done!
</span></code></pre></div>
<p>Oops again! Now we've got a bug.</p>

<h2 id="type-classes-to-the-rescue">Type Classes to the rescue</h2>

<p>Let us define a type class for discriminating between types at <em>compile-time</em>:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">trait</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span>
<span class="o">}</span>
</code></pre></div>
<p>Now our function can look like this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">def</span> <span class="nf">guarantee</span><span class="o">[</span><span class="kt">R:</span> <span class="kt">CanGuarantee</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span>
  <span class="n">implicitly</span><span class="o">[</span><span class="kt">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]].</span><span class="py">guarantee</span><span class="o">(</span><span class="n">f</span><span class="o">)(</span><span class="n">finalizer</span><span class="o">)</span>
</code></pre></div>
<p>To get the behavior of the original sample, we can define the default instances in the companion object like this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">object</span> <span class="nc">CanGuarantee</span>  <span class="o">{</span>
  <span class="c1">// Future instance
</span>  <span class="k">implicit</span> <span class="k">def</span> <span class="nf">futureInstance</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span><span class="k">:</span> <span class="kt">CanGuarantee</span><span class="o">[</span><span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
        <span class="nc">Future</span><span class="o">(</span><span class="n">f</span><span class="o">).</span><span class="py">flatten</span><span class="o">.</span><span class="py">transform</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=&gt;</span>
          <span class="n">finalizer</span>
          <span class="n">r</span>
        <span class="o">}</span>
    <span class="o">}</span>

  <span class="c1">// Default instance
</span>  <span class="k">implicit</span> <span class="k">def</span> <span class="nf">syncInstance</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span><span class="k">:</span> <span class="kt">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span>
        <span class="k">try</span> <span class="n">f</span> <span class="k">finally</span> <span class="n">finalizer</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>The upside is that now the mechanism is extensible, without modifying the original function:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">final</span> <span class="k">class</span> <span class="nc">Thunk</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">val</span> <span class="nv">run</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Thunk</span> <span class="o">{</span>
  <span class="c1">// Extending our logic with a new data type
</span>  <span class="k">implicit</span> <span class="k">def</span> <span class="nf">canGuarantee</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span><span class="k">:</span> <span class="kt">CanGuarantee</span><span class="o">[</span><span class="kt">Thunk</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">Thunk</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Thunk</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Thunk</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
        <span class="k">new</span> <span class="nc">Thunk</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="o">{</span>
          <span class="k">try</span> <span class="nv">f</span><span class="o">.</span><span class="py">run</span><span class="o">()</span> <span class="k">finally</span> <span class="n">finalizer</span>
        <span class="o">})</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h2 id="the-problem-with-defaults">The problem with defaults</h2>

<p>What happens in case you don't define <code class="highlighter-rouge">CanGuarantee[Thunk[A]]</code>?</p>

<div class="highlight"><pre class="highlight scala"><code><span class="n">guarantee</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nc">Thunk</span> <span class="o">{</span> <span class="o">()</span> <span class="k">=&gt;</span>
    <span class="nf">println</span><span class="o">(</span><span class="s">"Calculating!"</span><span class="o">)</span>
    <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="s">"Done!"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div>
<p>The <code class="highlighter-rouge">syncInstance</code> that we defined above is incorrect for <code class="highlighter-rouge">Thunk</code>. This means that we can introduce silent bugs. What should happen here?</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span>

<span class="n">guarantee</span> <span class="o">{</span>
  <span class="nv">CompletableFuture</span><span class="o">.</span><span class="py">runAsync</span> <span class="o">{</span> <span class="o">()</span> <span class="k">=&gt;</span>
    <span class="nf">println</span><span class="o">(</span><span class="s">"Running!"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="o">{</span>
  <span class="nf">println</span><span class="o">(</span><span class="s">"Done!"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">//=&gt; Done!
//=&gt; Running!
</span></code></pre></div>
<p>This is a bug waiting to happen.</p>

<p>Therefore one can make the case that the default instance, if it doesn't have the intended behavior for all data types, should not exist. But you can still provide a helper for creating one:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">import</span> <span class="nn">scala.annotation.implicitNotFound</span>

<span class="nd">@implicitNotFound</span><span class="o">(</span><span class="s">"""Cannot find implicit value for CanGuarantee[${R}].
If this value is synchronously calculated via an effectful function,
then use CanGuarantee.synchronous to create one."""</span><span class="o">)</span>
<span class="k">trait</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">CanGuarantee</span> <span class="o">{</span>
  <span class="c1">// No longer implicit
</span>  <span class="k">def</span> <span class="nf">synchronous</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span><span class="k">:</span> <span class="kt">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">R</span> <span class="o">=</span>
        <span class="k">try</span> <span class="n">f</span> <span class="k">finally</span> <span class="n">finalizer</span>
    <span class="o">}</span>

  <span class="c1">// Future instance
</span>  <span class="k">implicit</span> <span class="k">def</span> <span class="nf">futureInstance</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span><span class="k">:</span> <span class="kt">CanGuarantee</span><span class="o">[</span><span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">CanGuarantee</span><span class="o">[</span><span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">guarantee</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">finalizer</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
        <span class="nc">Future</span><span class="o">(</span><span class="n">f</span><span class="o">).</span><span class="py">flatten</span><span class="o">.</span><span class="py">transform</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=&gt;</span>
          <span class="n">finalizer</span>
          <span class="n">r</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Notice the usage of Scala's <a href="https://www.scala-lang.org/api/current/scala/annotation/implicitNotFound.html">@implicitNotFound</a> annotation for providing a nice error message.</p>

<p>Let's see what happens now when we try running the <code class="highlighter-rouge">CompletableFuture</code> code again:</p>

<div class="highlight"><pre class="highlight plaintext"><code>error: Cannot find implicit value for CanGuarantee[CompletableFuture[Void]].
If this value is synchronously calculated via an effectful function,
then use CanGuarantee.synchronous to create one.
</code></pre></div>
<p>That's better. This now goes for <code class="highlighter-rouge">Unit</code> as well:</p>

<div class="highlight"><pre class="highlight plaintext"><code>scala&gt; guarantee { println("Executing!") } { println("Done!") }

error: Cannot find implicit value for CanGuarantee[Unit].
If this value is synchronously calculated via an effectful function,
then use CanGuarantee.synchronous[Unit] to create one.
       guarantee { println("Executing!") } { println("Done!") }
                                           ^
</code></pre></div>
<p>If you want to work with <code class="highlighter-rouge">Unit</code>, you have to create an instance for it, but notice how the error message tells you exactly what to do:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">implicit</span> <span class="k">val</span> <span class="nv">ev</span> <span class="k">=</span> <span class="nv">CanGuarantee</span><span class="o">.</span><span class="py">synchronous</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>

<span class="n">guarantee</span> <span class="o">{</span> <span class="nf">println</span><span class="o">(</span><span class="s">"Executing!"</span><span class="o">)</span> <span class="o">}</span> <span class="o">{</span> <span class="nf">println</span><span class="o">(</span><span class="s">"Done!"</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>
<h2 id="in-conclusion">In conclusion</h2>

<p>Friends don't let friends use <code class="highlighter-rouge">isInstanceOf</code> checks, because Scala has better ways of handling the related use cases.</p>

<p>Enjoy~</p>


    <div class="authorship" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alexandru Nedelcu">
      Written by <a href="https://alexn.org/about.html" itemprop="url" rel="author">
        Alexandru Nedelcu</a> |
      <a href="https://twitter.com/alexelcu" itemprop="url" rel="author">
        Twitter</a> |
      <a href="https://github.com/alexandru" itemprop="url" rel="author">
        GitHub</a>
    </div>
  </div>

  <footer>
    <div id="other-articles">
      <h2>Recent Articles</h2>

      <ul class="posts">
      	<li>
      	  <time datetime="2018-05-06">
      	    2018-05-06 &raquo;
      	  </time>
      	  <a href="/blog/2018/05/06/bifunctor-io.html" rel="prefetch related">On Bifunctor IO and Java's Checked Exceptions</a>
      	</li>
      	<li>
      	  <time datetime="2018-02-12">
      	    2018-02-12 &raquo;
      	  </time>
      	  <a href="/blog/2018/02/12/in-defense-oofp.html" rel="prefetch related">In Defense of OOFP</a>
      	</li>
      	<li>
      	  <time datetime="2017-11-10">
      	    2017-11-10 &raquo;
      	  </time>
      	  <a href="/blog/2017/11/10/minitest-no-crap-scala-library.html" rel="prefetch related">Minitest: Zero Crap Scala Testing Library</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-15">
      	    2017-10-15 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/15/functional-programming.html" rel="prefetch related">What is Functional Programming?</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-13">
      	    2017-10-13 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/13/scaladays-copenhagen.html" rel="prefetch related">Scala Days 2017 — Monix Task</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-11">
      	    2017-10-11 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/11/javascript-promise-leaks-memory.html" rel="prefetch related">JavaScript's Promise Leaks Memory</a>
      	</li>
      	<li>
      	  <time datetime="2017-08-16">
      	    2017-08-16 &raquo;
      	  </time>
      	  <a href="/blog/2017/08/16/automatic-releases-sbt-travis.html" rel="prefetch related">Automatic Releases to Maven Central with Travis and SBT</a>
      	</li>
      </ul>
    </div>

    <div id="contributions">
      <script data-isso="/comments/alexn/"
              data-isso-css="true"
              data-isso-lang="en"
              data-isso-reply-to-self="true"
              data-isso-require-author="true"
              data-isso-require-email="false"
              data-isso-reply-notifications="true"
              data-isso-max-comments-top="10"
              data-isso-max-comments-nested="5"
              data-isso-reveal-on-click="5"
              data-isso-gravatar="true"
              data-isso-avatar="false"
              data-isso-vote="true"
              data-vote-levels=""
              src="https://alexn.org/comments/alexn/js/embed.min.js"></script>
      <section id="isso-thread" data-title="Scala's isInstanceOf is an Anti-Pattern">
      </section>
    </div>
  </footer>
</article>

    </div>
  </div>

  <div id="footer-container">
    <footer>
      <div class="rss">
      	<a href="https://twitter.com/alexelcu" target="_blank" title="Follow me on Twitter (@alexelcu)">
      	  <img src="/assets/img/twitter-logo.png" width="60" height="60" alt="Follow me on Twitter (@alexelcu)" />
      	</a>
      </div>

      <div class="links">
        <a href="/docs/privacy-policy.html">Privacy policy</a> |
        <a href="https://twitter.com/alexelcu" target="_blank">Twitter</a> |
        <a href="https://github.com/alexandru" target="_blank">GitHub</a>
      </div>

      <div class="contact">
      	&copy; 2019 Alexandru Nedelcu
      	<br>
      	Some rights reserved (<a href="http://creativecommons.org/licenses/by-nc/3.0/" rel="license">CC BY-NC 3.0</a>)
      </div>
    </footer>
  </div>

  <!-- Analytics -->
  <script>
    function loadAnalytics() {
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-84530423-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    }
    // Checks DO-NOT-TRACK status
    if (window.doNotTrack || navigator.doNotTrack || navigator.msDoNotTrack || 'msTrackingProtectionEnabled' in window.external) {
      var dnd = window.doNotTrack == "1" || navigator.doNotTrack == "yes" || navigator.doNotTrack == "1" || navigator.msDoNotTrack == "1" || window.external.msTrackingProtectionEnabled();
      if (!dnd) loadAnalytics();
    } else {
      loadAnalytics();
    }
  </script>
  <!-- End Analytics -->  
</body>
</html>
