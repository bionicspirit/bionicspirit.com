<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <link rel="canonical" href="https://alexn.org/blog/2019/11/22/howto-regexp-replacement-via-function-java-scala.html">
  <link rel="alternate" href="/atom.xml" title="Atom feed" type="application/atom+xml">

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@alexelcu" />

    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2019-11-22" />
    
    <meta property="article:tag" content="Programming" />
    <meta property="article:tag" content="Scala" />
    <meta property="article:tag" content="Ruby" />

    <title>Regexp Replacement via Function in Java/Scala</title>
    <meta name="og:title" content="Regexp Replacement via Function in Java&#x2F;Scala" />
    <meta name="twitter:title" content="Regexp Replacement via Function in Java&#x2F;Scala" />

      <meta name="og:image" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg" />
      <meta name="og:image:secure_url" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg" />
      <meta name="twitter:image" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg" />

      <meta name="og:description" content="Replace in strings via regexp, with the replacement being calculated via a function." />
      <meta name="twitter:description" content="Replace in strings via regexp, with the replacement being calculated via a function." />
      <meta name="description" content="Replace in strings via regexp, with the replacement being calculated via a function." />

  <link href="/assets/css/fonts-8b37e535.css" rel="stylesheet" />
  <link href="/assets/css/all-242873bd.css" rel="stylesheet" />
  <!--[if lt IE 9]>
  <link href="/assets/css/ie-hacks-f1291769.css" rel="stylesheet" />
  <![endif]-->
</head>
<body>
  <div id="header-container">
    <header>
      <h1 id="title">alexn.org</h1>

      <meta itemprop="lastReviewed" content="2019-11-22"/>
      <div itemprop="reviewedBy" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <meta itemprop="url" content="https://alexn.org/about.html">
      </div>

      <div class="github-fork-ribbon-wrapper right">
        <div class="github-fork-ribbon">
          <a href="https://github.com/alexandru" itemprop="relatedLink">Fork me on GitHub</a>
        </div>
      </div>

      <nav>
    	  <a href="/">alexn.org</a>
    	  <a class="extra" href="/about.html" itemprop="significantLink">About</a>
      </nav>
    </header>
  </div>

  <div id="main-container">
    <div id="main">
      <article id="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 itemprop="headline">Regexp Replacement via Function in Java/Scala</h1>

    <div id="meta">
      <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2019/11/22/howto-regexp-replacement-via-function-java-scala.html"/>
      <meta itemprop="datePublished" content="2019-11-22"/>
      <meta itemprop="dateModified" content="2019-11-22"/>

      <time class="post-date" itemprop="dateCreated" datetime="2019-11-22">
        Nov 22, 2019
      </time>

      <span class="twitter-link">
        â€¢ <a href="https://twitter.com/alexelcu">@alexelcu</a>
      </span>

        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/alex-nedelcu-400-square.jpg">
          <meta itemprop="width" content="400">
          <meta itemprop="height" content="400">
        </div>

      <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/alex-big-version-72ppi.jpg">
          <meta itemprop="width" content="585">
          <meta itemprop="height" content="585">
        </div>
      </div>
    </div>
  </header>

  <div id="content" itemprop="articleBody">
    <p>Article explains how to have fine grained control over replacements when using
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#replaceAll(java.lang.String,java.lang.String)">String.replaceAll</a>
or similar in Java or Scala. The samples given are in Scala, but if you're a
Java user, the snippets can be easily translated without any issues.</p>

<p class="extra-info">
  The following task should be obvious to accomplish in Scala / Java,
  yet I've lost 2 hours on it, because Java's standard library is aged
  and arcane.
  <br /><br />
  Writing this article mostly for myself, to dump this somewhere ðŸ™‚
</p>

<p>In Ruby if  you want to replace all occurrences of a string, via a regular expression, you can use <a href="https://ruby-doc.org/core-2.6.5/String.html#method-i-gsub">gsub</a>:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="s2">"HelloWorld!"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/(?&lt;=[a-z0-9_])[A-Z]/</span><span class="p">,</span> <span class="s1">' \0'</span><span class="p">)</span>
<span class="c1">#=&gt; Hello World!</span>
</code></pre></div>
<p>This API is available in Scala/Java as well:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="s">"HelloWorld!"</span><span class="o">.</span><span class="py">replaceAll</span><span class="o">(</span><span class="s">"(?&lt;=[a-z0-9_])[A-Z]"</span><span class="o">,</span> <span class="s">" $0"</span><span class="o">)</span>
<span class="c1">// res: String = Hello World!
</span></code></pre></div>
<p>However Ruby goes one step further and accepts as the replacement a function block:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="s2">"HelloWorld!"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/(?&lt;=[a-z0-9_])[A-Z]/</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">ch</span><span class="o">|</span> <span class="n">ch</span><span class="p">.</span><span class="nf">downcase</span> <span class="p">}</span>
<span class="c1">#=&gt; Hello world!</span>

<span class="s2">"Apollo 12"</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">num</span><span class="o">|</span> <span class="n">num</span><span class="p">.</span><span class="nf">to_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>
<span class="c1">#=&gt; "Apollo 13"</span>
</code></pre></div>
<p>The Java API exposed by <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Pattern.html">Pattern</a> is a little awkward, so lets see how to do this in Scala / Java:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">type</span> <span class="kt">Index</span> <span class="o">=</span> <span class="nc">Int</span>
<span class="k">type</span> <span class="kt">MatchGroup</span> <span class="o">=</span> <span class="nc">String</span>

<span class="k">def</span> <span class="nf">replaceAll</span><span class="o">(</span><span class="n">regex</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">,</span> <span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
  <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">Index</span><span class="o">,</span> <span class="kt">MatchGroup</span><span class="o">,</span> <span class="nc">List</span><span class="o">[</span><span class="kt">MatchGroup</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="nc">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>

  <span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="nv">regex</span><span class="o">.</span><span class="py">matcher</span><span class="o">(</span><span class="n">input</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">sb</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span>

  <span class="nf">while</span> <span class="o">(</span><span class="nv">m</span><span class="o">.</span><span class="py">find</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">groups</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">buffer</span> <span class="k">=</span> <span class="nv">ListBuffer</span><span class="o">.</span><span class="py">empty</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
      <span class="k">var</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span>
      <span class="nf">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nv">m</span><span class="o">.</span><span class="py">groupCount</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">buffer</span> <span class="o">+=</span> <span class="nv">m</span><span class="o">.</span><span class="py">group</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="o">}</span>
      <span class="nv">buffer</span><span class="o">.</span><span class="py">toList</span>
    <span class="o">}</span>
    <span class="k">val</span> <span class="nv">replacement</span> <span class="k">=</span> <span class="nf">f</span><span class="o">(</span><span class="nv">m</span><span class="o">.</span><span class="py">start</span><span class="o">(),</span> <span class="nv">m</span><span class="o">.</span><span class="py">group</span><span class="o">(),</span> <span class="n">groups</span><span class="o">)</span>
    <span class="nv">m</span><span class="o">.</span><span class="py">appendReplacement</span><span class="o">(</span><span class="n">sb</span><span class="o">,</span> <span class="nv">Matcher</span><span class="o">.</span><span class="py">quoteReplacement</span><span class="o">(</span><span class="n">replacement</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="nv">m</span><span class="o">.</span><span class="py">appendTail</span><span class="o">(</span><span class="n">sb</span><span class="o">)</span>
  <span class="nv">sb</span><span class="o">.</span><span class="py">toString</span>
<span class="o">}</span>
</code></pre></div>
<p>What happens here is that <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Matcher.html">Matcher</a> allows you to replace all occurrences of a string with an iterator-like protocol by using:</p>

<ul>
  <li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Matcher.html#find()">.find</a>: for finding the next occurrence in a <code class="highlighter-rouge">while</code> loop</li>
  <li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuilder,java.lang.String)">.appendReplacement</a>: which appends the remaining text after the discovery of the last match and the current one, plus the replacement that you've calculated for the current match
    <ul>
      <li>Note this requires the usage of <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Matcher.html#quoteReplacement(java.lang.String)">quoteReplacement</a>, because otherwise the logic in <code class="highlighter-rouge">appendReplacement</code> will treat certain special chars like <code class="highlighter-rouge">\</code> and <code class="highlighter-rouge">$</code>, so this specifies that you want the replacement to be verbatim</li>
    </ul>
  </li>
  <li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Matcher.html#appendTail(java.lang.StringBuilder)">.appendTail</a>: to append to the final string whatever is left</li>
</ul>

<p>We can now describe something like this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">def</span> <span class="nf">camelCaseToSnakeCase</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
  <span class="nf">replaceAll</span><span class="o">(</span><span class="s">"[A-Z](?=[a-z0-9_])"</span><span class="o">.</span><span class="py">r</span><span class="o">.</span><span class="py">pattern</span><span class="o">,</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">ch</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="o">(</span><span class="nf">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="s">"_"</span> <span class="k">else</span> <span class="s">""</span><span class="o">)</span> <span class="o">+</span> <span class="nv">ch</span><span class="o">.</span><span class="py">toLowerCase</span>
  <span class="o">}</span>

<span class="c1">// And usage:
</span><span class="nf">camelCaseToSnakeCase</span><span class="o">(</span><span class="s">"RebuildSubscribersCounts"</span><span class="o">)</span>
<span class="c1">//=&gt; res: String = rebuild_subscribers_counts
</span></code></pre></div>
<p>Or like this:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">def</span> <span class="nf">incrementNumbersIn</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
  <span class="nf">replaceAll</span><span class="o">(</span><span class="s">"\\d+"</span><span class="o">.</span><span class="py">r</span><span class="o">.</span><span class="py">pattern</span><span class="o">,</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">num</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="o">(</span><span class="nv">num</span><span class="o">.</span><span class="py">toInt</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="py">toString</span>
  <span class="o">}</span>

<span class="c1">// And usage:
</span><span class="nf">incrementNumbersIn</span><span class="o">(</span><span class="s">"Apollo 12"</span><span class="o">)</span>
<span class="c1">//=&gt; res: String = Apollo 13
</span></code></pre></div>
<p>Enjoy ~</p>


    <div class="authorship" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alexandru Nedelcu">
      Written by <a href="https://alexn.org/about.html" itemprop="url" rel="author">
        Alexandru Nedelcu</a> |
      <a href="https://twitter.com/alexelcu" itemprop="url" rel="author">
        Twitter</a> |
      <a href="https://github.com/alexandru" itemprop="url" rel="author">
        GitHub</a>
    </div>
  </div>

  <footer>
    <div id="other-articles">
      <h2>Recent Articles</h2>

      <ul class="posts">
      	<li>
      	  <time datetime="2019-08-11">
      	    2019-08-11 &raquo;
      	  </time>
      	  <a href="/blog/2019/08/11/isinstanceof-anti-pattern.html" rel="prefetch related">Scala's isInstanceOf is an Anti-Pattern</a>
      	</li>
      	<li>
      	  <time datetime="2018-05-06">
      	    2018-05-06 &raquo;
      	  </time>
      	  <a href="/blog/2018/05/06/bifunctor-io.html" rel="prefetch related">On Bifunctor IO and Java's Checked Exceptions</a>
      	</li>
      	<li>
      	  <time datetime="2018-02-12">
      	    2018-02-12 &raquo;
      	  </time>
      	  <a href="/blog/2018/02/12/in-defense-oofp.html" rel="prefetch related">In Defense of OOFP</a>
      	</li>
      	<li>
      	  <time datetime="2017-11-10">
      	    2017-11-10 &raquo;
      	  </time>
      	  <a href="/blog/2017/11/10/minitest-no-crap-scala-library.html" rel="prefetch related">Minitest: Zero Crap Scala Testing Library</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-15">
      	    2017-10-15 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/15/functional-programming.html" rel="prefetch related">What is Functional Programming?</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-13">
      	    2017-10-13 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/13/scaladays-copenhagen.html" rel="prefetch related">Scala Days 2017 â€” Monix Task</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-11">
      	    2017-10-11 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/11/javascript-promise-leaks-memory.html" rel="prefetch related">JavaScript's Promise Leaks Memory</a>
      	</li>
      </ul>
    </div>

    <div id="contributions">
      <script data-isso="/comments/alexn/"
              data-isso-css="true"
              data-isso-lang="en"
              data-isso-reply-to-self="true"
              data-isso-require-author="true"
              data-isso-require-email="false"
              data-isso-reply-notifications="true"
              data-isso-max-comments-top="10"
              data-isso-max-comments-nested="5"
              data-isso-reveal-on-click="5"
              data-isso-gravatar="true"
              data-isso-avatar="false"
              data-isso-vote="true"
              data-vote-levels=""
              src="https://alexn.org/comments/alexn/js/embed.min.js"></script>
      <section id="isso-thread" data-title="Regexp Replacement via Function in Java/Scala">
      </section>
    </div>
  </footer>
</article>

    </div>
  </div>

  <div id="footer-container">
    <footer>
      <div class="rss">
      	<a href="https://twitter.com/alexelcu" target="_blank" title="Follow me on Twitter (@alexelcu)">
      	  <img src="/assets/img/twitter-logo.png" width="60" height="60" alt="Follow me on Twitter (@alexelcu)" />
      	</a>
      </div>

      <div class="links">
        <a href="/docs/privacy-policy.html">Privacy policy</a> |
        <a href="https://twitter.com/alexelcu" target="_blank">Twitter</a> |
        <a href="https://github.com/alexandru" target="_blank">GitHub</a>
      </div>

      <div class="contact">
      	&copy; 2019 Alexandru Nedelcu
      	<br>
      	Some rights reserved (<a href="http://creativecommons.org/licenses/by-nc/3.0/" rel="license">CC BY-NC 3.0</a>)
      </div>
    </footer>
  </div>

  <!-- Analytics -->
  <script>
    function loadAnalytics() {
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-84530423-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    }
    // Checks DO-NOT-TRACK status
    if (window.doNotTrack || navigator.doNotTrack || navigator.msDoNotTrack || 'msTrackingProtectionEnabled' in window.external) {
      var dnd = window.doNotTrack == "1" || navigator.doNotTrack == "yes" || navigator.doNotTrack == "1" || navigator.msDoNotTrack == "1" || window.external.msTrackingProtectionEnabled();
      if (!dnd) loadAnalytics();
    } else {
      loadAnalytics();
    }
  </script>
  <!-- End Analytics -->  
</body>
</html>
