<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <link rel="canonical" href="https://alexn.org/blog/2015/09/06/monifu-vs-akka-streams.html">
  <link rel="alternate" href="/atom.xml" title="Atom feed" type="application/atom+xml">

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@alexelcu" />

    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2015-09-06" />
    
    <meta property="article:tag" content="Functional" />
    <meta property="article:tag" content="Scala" />
    <meta property="article:tag" content="Rx" />
    <meta property="article:tag" content="Reactive Streams" />

    <title>Monifu vs Akka Streams</title>
    <meta name="og:title" content="Monifu vs Akka Streams" />
    <meta name="twitter:title" content="Monifu vs Akka Streams" />

      <meta name="og:image" content="https://alexn.org/assets/img/2015/monifu-square.png" />
      <meta name="og:image:secure_url" content="https://alexn.org/assets/img/2015/monifu-square.png" />
      <meta name="twitter:image" content="https://alexn.org/assets/img/2015/monifu-square.png" />

      <meta name="og:description" content="Functional, Scala, Rx, Reactive Streams" />
      <meta name="twitter:description" content="Functional, Scala, Rx, Reactive Streams" />
      <meta name="description" content="Functional, Scala, Rx, Reactive Streams" />

  <link href="/assets/css/fonts-8b37e535.css" rel="stylesheet" />
  <link href="/assets/css/all-b9d1ad87.css" rel="stylesheet" />
  <!--[if lt IE 9]>
  <link href="/assets/css/ie-hacks-0c76b2ed.css" rel="stylesheet" />
  <![endif]-->

  <!-- Google authorship -->
  <link href="https://plus.google.com/+alexelcu" rel="publisher">
</head>
<body>
  <div id="header-container">
    <header>
      <h1 id="title">alexn.org</h1>

      <meta itemprop="lastReviewed" content="2018-07-31"/>
      <div itemprop="reviewedBy" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <meta itemprop="url" content="https://plus.google.com/+alexelcu">
      </div>

      <div class="github-fork-ribbon-wrapper right">
        <div class="github-fork-ribbon">
          <a href="https://github.com/alexandru" itemprop="relatedLink">Fork me on GitHub</a>
        </div>
      </div>

      <nav>
    	  <a href="/">alexn.org</a>
    	  <a class="extra" href="/about.html" itemprop="significantLink">About</a>
      </nav>
    </header>
  </div>

  <div id="main-container">
    <div id="main">
      <article id="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 itemprop="headline">Monifu vs Akka Streams</h1>

    <div id="meta">
      <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2015/09/06/monifu-vs-akka-streams.html"/>
      <meta itemprop="datePublished" content="2015-09-06"/>
      <meta itemprop="dateModified" content="2015-09-06"/>

      <time class="post-date" itemprop="dateCreated" datetime="2015-09-06">
        Sep 06, 2015
      </time>

      <span class="twitter-link">
        • <a href="https://twitter.com/alexelcu">@alexelcu</a>
      </span>

        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/2015/monifu-square.png">
          <meta itemprop="width" content="500">
          <meta itemprop="height" content="303">
        </div>

      <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
        <meta itemprop="name" content="Alexandru Nedelcu">
        <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/img/alex-big-version-72ppi.jpg">
          <meta itemprop="width" content="585">
          <meta itemprop="height" content="585">
        </div>
      </div>
    </div>
  </header>

  <div id="content" itemprop="articleBody">
    <p>Back in June I attended
<a href="http://event.scaladays.org/scaladays-amsterdam-2015">Scala Days</a> in
Amsterdam and participated at a talk by Mathias Doenitz on
<a href="https://www.parleys.com/tutorial/the-reactive-streams-implementation-landscape">The Reactive Streams Implementation Landscape</a>.
It was a good talk, yet I felt a little bias towards Akka Streams,
which is natural coming from somebody that is contributing to Akka,
but let me give you the perspective from <em>the other side</em>.</p>

<p><img src="/assets/img/2015/monifu-square.png" class="right" width="300" alt="Monifu square" /></p>

<p>For a short introduction, we are talking about libraries that are
meant for stream processing. Several libraries exist for stream
processing, a craze that started with
<a href="https://msdn.microsoft.com/en-us/data/gg577609.aspx">Rx.NET</a>, or with
<a href="https://en.wikipedia.org/wiki/Iteratee">Iteratees</a> on the Haskell
side and since then we ended up with ports and enhancements, like
<a href="https://github.com/ReactiveX/RxJava">RxJava</a>,
<a href="https://github.com/Reactive-Extensions/RxJS">Rx.js</a>,
<a href="https://baconjs.github.io/">Bacon.js</a>,
<a href="https://www.playframework.com/documentation/2.4.x/Iteratees">Play's Iteratees</a>,
<a href="https://github.com/scalaz/scalaz-stream">Scalaz Streams</a> and more
recently
<a href="http://doc.akka.io/docs/akka-stream-and-http-experimental/current/">Akka Streams</a>.</p>

<p>The library I've been working on is named
<strong><a href="https://github.com/monifu/monifu">Monifu</a></strong>. It has just
reached 1.0-RC1, it is built on idiomatic Scala principles, is
cross-compiled to <a href="http://www.scala-js.org/">Scala.js</a>, is freaking
awesome and even though it is inspired by Rx, compared to other Rx
implementations, it was designed from scratch to deal with
back-pressure. It's also implementing the 1.0 version of the
<a href="http://www.reactive-streams.org/">Reactive Streams</a> protocol for
interoperability. Checkout this cool sample of client/server
communications, where both the server-side and the browser-side is handled
by Monifu: <a href="https://github.com/monifu/monifu-sample">code</a> /
<a href="http://monifu-sample.herokuapp.com/">demo</a>
(that's a free Heroku node, go easy on it :-)).</p>

<h2 id="code">Code</h2>

<p>I am biased, I admit. But personally I find the design of Akka Streams
to be <em>conceptually ugly</em>.</p>

<p>Mathias was kind to release his comparison
<a href="https://github.com/sirthias/rs-comparison">on GitHub</a>, containing the
same problem solved with Akka Streams, RxJava and Reactor and I think
this provides a good starting point for a comparison.  So lets take
Mathias's own
<a href="https://github.com/alexandru/rs-comparison/blob/master/src/main/scala/swave/rsc/AkkaPi.scala">sample for Akka Streams</a>
and compare it with my
<a href="https://github.com/alexandru/rs-comparison/blob/master/src/main/scala/swave/rsc/MonifuPi.scala">own sample for Monifu</a>. Akka
Streams is missing some useful operators, like operators for
throttling, therefore the code needs to implement it.</p>

<p>To throttle once per second, here's what the Akka Streams sample is doing:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="c1">// Akka Streams sample
</span><span class="k">def</span> <span class="n">onePerSecValve</span><span class="k">:</span> <span class="kt">Flow</span><span class="o">[</span><span class="kt">State</span>, <span class="kt">State</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Flow</span><span class="o">()</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">b</span> <span class="k">⇒</span>
    <span class="k">import</span> <span class="nn">FlowGraph.Implicits._</span>

    <span class="k">val</span> <span class="n">zip</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">ZipWith</span><span class="o">[</span><span class="kt">State</span>, <span class="kt">Tick.</span><span class="k">type</span>, <span class="kt">State</span><span class="o">](</span><span class="nc">Keep</span><span class="o">.</span><span class="n">left</span><span class="o">)</span>
      <span class="o">.</span><span class="n">withAttributes</span><span class="o">(</span><span class="nc">OperationAttributes</span><span class="o">.</span><span class="n">inputBuffer</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)))</span>
    <span class="k">val</span> <span class="n">dropOne</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">Flow</span><span class="o">[</span><span class="kt">State</span><span class="o">].</span><span class="n">drop</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>

    <span class="nc">Source</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="nc">Zero</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">,</span> <span class="nc">Tick</span><span class="o">)</span> <span class="o">~&gt;</span> <span class="n">zip</span><span class="o">.</span><span class="n">in1</span>
    <span class="n">zip</span><span class="o">.</span><span class="n">out</span> <span class="o">~&gt;</span> <span class="n">dropOne</span><span class="o">.</span><span class="n">inlet</span>

    <span class="o">(</span><span class="n">zip</span><span class="o">.</span><span class="n">in0</span><span class="o">,</span> <span class="n">dropOne</span><span class="o">.</span><span class="n">outlet</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre></div>
<p>Monifu has
<a href="https://monifu.org/api/1.0-RC1/index.html#monifu.reactive.Observable@throttleFirst(interval:scala.concurrent.duration.FiniteDuration):monifu.reactive.Observable[T]">throttling operators</a>
built-in, but if that weren't the case, here's how you could implement
sampling per second:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="c1">// Monifu sample
</span><span class="k">def</span> <span class="n">throttleOnePerSec</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">source</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">Observable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">tick</span> <span class="k">=</span> <span class="nc">Observable</span><span class="o">.</span><span class="n">intervalAtFixedRate</span><span class="o">(</span><span class="mf">1.</span><span class="n">second</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">)</span>
  <span class="n">source</span><span class="o">.</span><span class="n">whileBusyDropEvents</span><span class="o">.</span><span class="n">zip</span><span class="o">(</span><span class="n">tick</span><span class="o">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">elem</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">elem</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Both pieces of code are doing roughly the same thing. A different
data-source is being started that generates a tick over every second
and that data-source is being <code class="highlighter-rouge">zipped</code> with our source. Events emitted
by our source are dropped as long as the tick is silent and then when
the tick event happens we emit whatever we've got. Using <code class="highlighter-rouge">zip</code> for
sampling is actually very inefficient, as <code class="highlighter-rouge">zip</code> is a fundamentally
concurrent operator, but this is just for comparing apples with apples
;-)</p>

<p>So why is the code for Akka Streams looking so complicated? Well
that's because of its design, but lets come back to that later.
In the Akka Streams sample, here's how the original data-source is
being split in two streams (<code class="highlighter-rouge">filterInner</code> and <code class="highlighter-rouge">filterOuter</code>) and then
merged:</p>

<div class="highlight"><pre class="highlight scala"><code><span class="c1">// Akka Streams sample
</span><span class="nc">Source</span><span class="o">(()</span> <span class="k">⇒</span> <span class="k">new</span> <span class="nc">RandomDoubleValueGenerator</span><span class="o">())</span>
  <span class="o">.</span><span class="n">grouped</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">case</span> <span class="n">x</span> <span class="o">+:</span> <span class="n">y</span> <span class="o">+:</span> <span class="nc">Nil</span> <span class="k">⇒</span> <span class="nc">Point</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">.</span><span class="n">via</span><span class="o">(</span><span class="n">broadcastFilterMerge</span><span class="o">)</span>

<span class="c1">// ...
</span><span class="k">def</span> <span class="n">broadcastFilterMerge</span><span class="k">:</span> <span class="kt">Flow</span><span class="o">[</span><span class="kt">Point</span>, <span class="kt">Sample</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Flow</span><span class="o">()</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">b</span> <span class="k">⇒</span>
    <span class="k">import</span> <span class="nn">FlowGraph.Implicits._</span>

    <span class="k">val</span> <span class="n">broadcast</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">Broadcast</span><span class="o">[</span><span class="kt">Point</span><span class="o">](</span><span class="mi">2</span><span class="o">))</span> <span class="c1">// split one upstream into 2 downstreams
</span>    <span class="k">val</span> <span class="n">filterInner</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">Flow</span><span class="o">[</span><span class="kt">Point</span><span class="o">].</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">isInner</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="nc">InnerSample</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">filterOuter</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">Flow</span><span class="o">[</span><span class="kt">Point</span><span class="o">].</span><span class="n">filter</span><span class="o">(!</span><span class="k">_</span><span class="o">.</span><span class="n">isInner</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="nc">OuterSample</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">merge</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="nc">Merge</span><span class="o">[</span><span class="kt">Sample</span><span class="o">](</span><span class="mi">2</span><span class="o">))</span> <span class="c1">// merge 2 upstreams into one downstream
</span>
    <span class="n">broadcast</span><span class="o">.</span><span class="n">out</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">~&gt;</span> <span class="n">filterInner</span> <span class="o">~&gt;</span> <span class="n">merge</span><span class="o">.</span><span class="n">in</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="n">broadcast</span><span class="o">.</span><span class="n">out</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">~&gt;</span> <span class="n">filterOuter</span> <span class="o">~&gt;</span> <span class="n">merge</span><span class="o">.</span><span class="n">in</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

    <span class="o">(</span><span class="n">broadcast</span><span class="o">.</span><span class="n">in</span><span class="o">,</span> <span class="n">merge</span><span class="o">.</span><span class="n">out</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre></div>
<p>Here's Monifu's version, doing the same thing.</p>

<div class="highlight"><pre class="highlight scala"><code><span class="c1">// Monifu sample
</span><span class="k">val</span> <span class="n">source</span> <span class="k">=</span> <span class="nc">Observable</span>
  <span class="o">.</span><span class="n">fromIterator</span><span class="o">(</span><span class="k">new</span> <span class="nc">RandomDoubleValueGenerator</span><span class="o">())</span>
  <span class="o">.</span><span class="n">buffer</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">Seq</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">⇒</span> <span class="nc">Point</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">.</span><span class="n">share</span><span class="o">()</span> <span class="c1">// shares the data-source
</span>
<span class="k">val</span> <span class="n">innerSamples</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">isInner</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="nc">InnerSample</span><span class="o">)</span>
<span class="k">val</span> <span class="n">outerSamples</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">filter</span><span class="o">(!</span><span class="k">_</span><span class="o">.</span><span class="n">isInner</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="nc">OuterSample</span><span class="o">)</span>

<span class="nc">Observable</span><span class="o">.</span><span class="n">merge</span><span class="o">(</span><span class="n">innerSamples</span><span class="o">,</span> <span class="n">outerSamples</span><span class="o">)</span>
</code></pre></div>
<p>At this point I think a pattern emerges.</p>

<h2 id="design">Design</h2>

<p>A stream of information is like a river. Does the river care who
observes it or who drinks from it? No, it doesn't. And yes, sometimes
you need to share the source between multiple listeners, sometimes you
want to create new sources for each listener. But the listener
shouldn't care what sort of producer it has on its hands or
vice-versa. And people are really not good at reasoning about graphs
and making those graphs explicit doesn't make it better, it makes it
worse.</p>

<p><img src="/assets/img/2015/river.jpg" class="right" width="300" alt="River" /></p>

<p>In Monifu / Rx you've got hot observables (hot data sources shared
between an unlimited number of subscribers) and cold observables (each
subscriber gets its very own private data source). You can also
convert any cold data source into a hot one by using the <code class="highlighter-rouge">multicast</code>
operator, in combination with <code class="highlighter-rouge">Subjects</code> that dictate behavior
(e.g. Publish, Behavior, Async or Replay). The
<a href="https://monifu.org/api/1.0-RC1/index.html#monifu.reactive.observables.ConnectableObservable">ConnectableObservable</a>
is meant for hot data sources. In our sample above, we are using
<code class="highlighter-rouge">share()</code>, an operator that transforms our data source into a hot one
and then applies reference counting on its subscribers to know when to
stop it. This is what <em>encapsulation</em> is all about.</p>

<p>In Akka Streams the sources have a "single output" port and what you
do is you build "flow graphs" and sinks. Akka Streams is thus all
about modeling how streams are split. They call it "<em>explicit
fan-out</em>" and it's a design choice. However I consider it an
encapsulation leak that makes things way more complicated than they
should be and defeats the purpose of using a library for streams
manipulation in the first place. In Rx (Rx.NET / RxJava / Monifu)
terms, this is like having single-subscriber Observables and then
working with Subjects (which is both a listener and a producer) and
people that have used Rx know that working with Subjects sucks and
when you do, you usually encapsulate it really, really well. This
design choice of Akka Streams has also leaked into the "Reactive
Streams" specification, as that Processor interface is irrelevant,
plus during the talks on what the <code class="highlighter-rouge">Producer</code> should be, the original
design was for the <code class="highlighter-rouge">Producer</code> to be single-subscriber.</p>

<p>Another thing I don't like is that Akka Streams depends on Akka, the
library. You need an Actor System and an <code class="highlighter-rouge">ActorFlowMaterializer</code>,
whatever that is, with the tasks being executed by actors. I think
that's a design mistake. One reason for why Scala's <code class="highlighter-rouge">Future</code> and
<code class="highlighter-rouge">ExecutionContext</code> are great is precisely because they model only
asynchronous computations, but are completely oblivious to how the
required asynchronous execution happens. This
is why <code class="highlighter-rouge">Future</code> works on top of Scala.js without problems.</p>

<p>And again, I'm biased, but Monifu's own implementation is conceptually
elegant. You've got the
<a href="https://github.com/monifu/monifu/blob/master/core/shared/src/main/scala/monifu/concurrent/Scheduler.scala#L34">Scheduler</a>
that is used to execute tasks (an evolved <code class="highlighter-rouge">ExecutionContext</code>), the
<a href="https://github.com/monifu/monifu/blob/v1.0-RC1/monifu/shared/src/main/scala/monifu/reactive/Observable.scala#L379">Observable</a>
interface which is the producer, characterized solely by its
<code class="highlighter-rouge">onSubscribe</code> function, then you've got the
<a href="https://github.com/monifu/monifu/blob/v1.0-RC1/monifu/shared/src/main/scala/monifu/reactive/Observer.scala#L42">Observer</a>
which represents the consumer and has the back-pressure protocol baked
in its API, the
<a href="https://github.com/monifu/monifu/blob/v1.0-RC1/monifu/shared/src/main/scala/monifu/reactive/Subject.scala#L34">Subject</a>
that is both a producer and a consumer, the
<a href="https://github.com/monifu/monifu/blob/master/monifu/shared/src/main/scala/monifu/reactive/Channel.scala#L28">Channel</a>
which represents a way to build Observables in an imperative way
without back-pressure concerns and the
<a href="https://github.com/monifu/monifu/blob/master/monifu/shared/src/main/scala/monifu/reactive/observables/ConnectableObservable.scala#L33">ConnectableObservable</a>,
which represents hot data-sources that are shared between multiple
subscribers. Monifu's internals are self-explanatory and (I hope) a
joy to go through.</p>

<p>I mean, this beauty describes Monifu's design and represents at least
half of what you need to know (and skipping over back-pressure
concerns, you
<a href="https://en.wikipedia.org/wiki/Observer_pattern">already know it</a>):</p>

<div class="highlight"><pre class="highlight scala"><code><span class="k">trait</span> <span class="nc">Observer</span><span class="o">[</span><span class="kt">-T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">onNext</span><span class="o">(</span><span class="n">elem</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Ack</span><span class="o">]</span>

  <span class="k">def</span> <span class="n">onError</span><span class="o">(</span><span class="n">ex</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>

  <span class="k">def</span> <span class="n">onComplete</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span>
<span class="o">}</span>
</code></pre></div>
<p>In contrast, I found the source-code and the concepts in Akka Streams
to be very hard to read and understand. Give it a try and compare.</p>

<h2 id="performance">Performance</h2>

<p>I've left the best part of Monifu for last. Here's running the Monifu
sample:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[info] Running swave.rsc.MonifuPi

After  1,909,713 samples π is approximated as 3.14102
After  4,132,610 samples π is approximated as 3.14240
After  6,342,356 samples π is approximated as 3.14241
After  8,513,597 samples π is approximated as 3.14239
After 10,696,940 samples π is approximated as 3.14176
After 12,897,762 samples π is approximated as 3.14165
After 15,099,261 samples π is approximated as 3.14160
After 17,326,511 samples π is approximated as 3.14169
After 19,529,832 samples π is approximated as 3.14164
After 21,752,232 samples π is approximated as 3.14170

[success] Total time: 11 s, completed Sep 6, 2015 2:48:06 PM
</code></pre></div>
<p>Here's Akka Streams:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[info] Running swave.rsc.AkkaPi

After     59,812 samples π is approximated as 3.12807
After    258,925 samples π is approximated as 3.13910
After    525,537 samples π is approximated as 3.14173
After    892,973 samples π is approximated as 3.14070
After  1,258,939 samples π is approximated as 3.14127
After  1,545,861 samples π is approximated as 3.14019
After  1,813,374 samples π is approximated as 3.14103
After  2,219,992 samples π is approximated as 3.14137
After  2,515,283 samples π is approximated as 3.14129
After  2,826,297 samples π is approximated as 3.14148

[success] Total time: 13 s, completed Sep 6, 2015 2:49:23 PM
</code></pre></div>
<p>Here's RxJava (RxScala):</p>

<div class="highlight"><pre class="highlight plaintext"><code>[info] Running swave.rsc.RxScalaPi

After    804,127 samples π is approximated as 3.11240
After  1,747,146 samples π is approximated as 3.12848
After  2,761,645 samples π is approximated as 3.13558
After  3,678,029 samples π is approximated as 3.13880
After  4,756,818 samples π is approximated as 3.13960
After  5,787,079 samples π is approximated as 3.14172
After  6,768,352 samples π is approximated as 3.14249
After  7,804,973 samples π is approximated as 3.14320
After  8,812,403 samples π is approximated as 3.14381
After  9,625,207 samples π is approximated as 3.14393

[success] Total time: 12 s, completed Sep 6, 2015 2:54:55 PM
</code></pre></div>
<p>The results:</p>

<p><img src="/assets/img/2015/bench.png" class="center max" width="1428" height="750" alt="Bench" /></p>

<p>So my Monifu sample is consistently beating Akka Streams by at least a
<strong>factor of 7</strong> and RxJava/RxScala by a <strong>factor of 2</strong>.</p>

<p>The difference is so large that either Akka Streams has some serious
improvements to achieve, or I'm doing something terribly wrong,
because this is Monifu's out-of-the-box behavior, as in I haven't even
attempted to fine tune the buffers or the scheduler for this sample.</p>

<p>But yes, Monifu was built for both ease of use and performance.</p>

<h2 id="final-words">Final Words</h2>

<p>Again, I'm biased, since I'm the author of an alternative, so take
this conclusion for what it is.</p>

<p>The precursors of Akka Streams have been
<a href="https://www.playframework.com/documentation/2.4.x/Iteratees">Play's Iteratees</a>
and the
<a href="http://doc.akka.io/docs/akka/2.2.0/scala/io-codec.html">Akka I/O Pipeline</a>,
the former on its way to deprecation, the latter already
deprecated. Unfortunately I'm seeing the same mistakes: implementation
hard to read, conceptualy very complicated, while exposing custom
binary operators in the hope of forming a DSL that will somehow fix
this complexity. And I'm all for wheel reinvention when it's done for
the right reasons, but I find this model to be inferior to an evolved
Rx (such as Monifu) and this is just one other design heading towards
deprecation.</p>

<p>If you're interested in Monifu, there's still some work to be done.
It's at release candidate for version 1.0, meaning that we're done breaking the
API and a very functional core is ready. Monifu has been developed in
parallel to its usage in production for the past year, should be fairly
solid and has very good test coverage as testament to that, but bugs may
still happen, since a lot of work went on this past month.
Documentation is sadly a work in progress and for now only the
<a href="http://monifu.org/api/current/">API documentation</a> is up to date. But we're
marching towards a 1.0 release you can rely on, which should be available
in about two weeks from now (if everything goes well). Checkout the
<a href="https://github.com/monifu/monifu">GitHub repo</a>, join
<a href="https://gitter.im/monifu/monifu">our chat channel</a> and give us feedback.</p>

<h3 id="update-sep-8-800-am">Update (Sep 8, 8:00 AM)</h3>

<p>Some interesting questions happened on
<a href="https://www.reddit.com/r/scala/comments/3jymvw/monifu_vs_akka_streams/">the reddit thread</a>.
To dispel some myths:</p>

<ol>
  <li>currently Akka Streams does no more parallelism than Monifu does</li>
  <li>in our sample Monifu is not single-threaded</li>
  <li>in our sample Monifu parallelizes the portion that it can, which
is the processing of <code class="highlighter-rouge">filterInner</code> and <code class="highlighter-rouge">filterOuter</code>, plus execution
is jumping threads, because Monifu as a matter of policy never keeps
a single thread occupied for too long</li>
  <li>you can't parallelize concurrent operations, that being an oxymoron,
which is why I'm dumbfounded by claims of parallelism</li>
</ol>

<p>Cheers,</p>


    <div class="authorship" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alexandru Nedelcu">
      Written by <a href="https://alexn.org/about.html" itemprop="url" rel="author">
        Alexandru Nedelcu</a> |
      <a href="https://twitter.com/alexelcu" itemprop="url" rel="author">
        Twitter</a> |
      <a href="https://github.com/alexandru" itemprop="url" rel="author">
        GitHub</a>
    </div>
  </div>

  <footer>
    <div id="other-articles">
      <h2>Recent Articles</h2>

      <ul class="posts">
      	<li>
      	  <time datetime="2018-05-06">
      	    2018-05-06 &raquo;
      	  </time>
      	  <a href="/blog/2018/05/06/bifunctor-io.html" rel="prefetch related">On Bifunctor IO and Java's Checked Exceptions</a>
      	</li>
      	<li>
      	  <time datetime="2018-02-12">
      	    2018-02-12 &raquo;
      	  </time>
      	  <a href="/blog/2018/02/12/in-defense-oofp.html" rel="prefetch related">In Defense of OOFP</a>
      	</li>
      	<li>
      	  <time datetime="2017-11-10">
      	    2017-11-10 &raquo;
      	  </time>
      	  <a href="/blog/2017/11/10/minitest-no-crap-scala-library.html" rel="prefetch related">Minitest: Zero Crap Scala Testing Library</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-15">
      	    2017-10-15 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/15/functional-programming.html" rel="prefetch related">What is Functional Programming?</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-13">
      	    2017-10-13 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/13/scaladays-copenhagen.html" rel="prefetch related">Scala Days 2017 — Monix Task</a>
      	</li>
      	<li>
      	  <time datetime="2017-10-11">
      	    2017-10-11 &raquo;
      	  </time>
      	  <a href="/blog/2017/10/11/javascript-promise-leaks-memory.html" rel="prefetch related">JavaScript's Promise Leaks Memory</a>
      	</li>
      	<li>
      	  <time datetime="2017-08-16">
      	    2017-08-16 &raquo;
      	  </time>
      	  <a href="/blog/2017/08/16/automatic-releases-sbt-travis.html" rel="prefetch related">Automatic Releases to Maven Central with Travis and SBT</a>
      	</li>
      </ul>
    </div>

    <div id="contributions">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'alexnorg';
        var disqus_url = 'http://alexn.org/blog/2015/09/06/monifu-vs-akka-streams.html';

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </footer>
</article>

    </div>
  </div>

  <div id="footer-container">
    <footer>
      <div class="contact">
      	&copy; 2018 Alexandru Nedelcu
      	<br>
      	Some rights reserved (<a href="http://creativecommons.org/licenses/by-nc/3.0/" rel="license">CC BY-NC 3.0</a>)
      </div>

      <div class="rss">
      	<a href="https://twitter.com/alexelcu" target="_blank" title="Follow me on Twitter (@alexelcu)">
      	  <img src="/assets/img/twitter-logo.png" width="60" height="60" alt="Follow me on Twitter (@alexelcu)" />
      	</a>
      </div>
    </footer>
  </div>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-84530423-1', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
  </script>
</body>
</html>
